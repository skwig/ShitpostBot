@host = http://localhost:8080

### INSTRUCTIONS
# This test suite validates repost detection behavior through machine-assertable actions.
# Each scenario posts images, then queries the actions endpoint to verify expected behavior.
# 
# Expected behaviors:
# - High similarity (same image, different format): 2 reactions (repost detected)
# - Low similarity (unrelated images): 0 reactions (not a repost)

### ============================================
### SCENARIO 1: High Similarity - Repost Detection
### ============================================

### 1a. Post original image
POST {{host}}/test/image-message
Content-Type: application/json

{
  "imageUrl": "https://media.discordapp.net/attachments/1319991503891861534/1449832200702001183/frenchcat.png?ex=694054f5&is=693f0375&hm=987e474fcc62613908de83ee2db12365472ec3bde4a27525185bbb80184e44e5&=&format=webp&quality=lossless&width=918&height=1155"
}

### Expected: {"messageId": 1000001, "tracked": true}

### 1b. Post repost (same image, JPG format)
POST {{host}}/test/image-message
Content-Type: application/json

{
  "imageUrl": "https://media.discordapp.net/attachments/1319991503891861534/1449832201049870376/frenchcat.jpg?ex=694054f5&is=693f0375&hm=b8b5a37d8b72b4261dd61781d1ba828285b3ed9e5e00f1e044c69a274e3b05af&=&format=webp&width=918&height=1155"
}

### Expected: {"messageId": 1000002, "tracked": true}

### 1c. Query actions - expect 2 reactions (repost detected)
GET {{host}}/test/actions/1000002?expectedCount=2&timeout=10000

### Expected response:
# {
#   "messageId": 1000002,
#   "actions": [
#     {"type": "reaction", "data": "{\"emoji\":\":police_car:\"}", "timestamp": "..."},
#     {"type": "reaction", "data": "{\"emoji\":\":rotating_light:\"}", "timestamp": "..."}
#   ],
#   "waitedMs": 2341
# }
# PASS if: actions.length == 2 && both are type "reaction"

### ============================================
### SCENARIO 2: Low Similarity - No Repost
### ============================================

### 2a. Post first image
POST {{host}}/test/image-message
Content-Type: application/json

{
  "imageUrl": "https://media.discordapp.net/attachments/1319991503891861534/1449824813462851675/RDT_20251203_1901397855856549389737722.jpg?ex=69404e13&is=693efc93&hm=9295add85964d52e714ff95792e0b6123bdbaa6149982afa93e3ec0d287c69aa&=&format=webp&width=854&height=1155"
}

### Expected: {"messageId": 1000003, "tracked": true}

### 2b. Post unrelated image
POST {{host}}/test/image-message
Content-Type: application/json

{
  "imageUrl": "https://media.discordapp.net/attachments/1319991503891861534/1449825108611825915/RDT_20250125_1000203858268434480552263.jpg?ex=69404e5a&is=693efcda&hm=01d74376049da7f5b1bb16484c9b7dfa7990f7ef28b2155670f1941e69e827e3&=&format=webp&width=1329&height=1155"
}

### Expected: {"messageId": 1000004, "tracked": true}

### 2c. Query actions - expect 0 reactions (not a repost)
GET {{host}}/test/actions/1000004?expectedCount=0&timeout=10000

### Expected response:
# {
#   "messageId": 1000004,
#   "actions": [],
#   "waitedMs": 10003
# }
# PASS if: actions.length == 0

### ============================================
### SCENARIO 3: High Similarity - WebP Formats
### ============================================

### 3a. Post WebP original
POST {{host}}/test/image-message
Content-Type: application/json

{
  "imageUrl": "https://media.discordapp.net/attachments/1319991503891861534/1449832201821753567/frenchcat.webp?ex=694054f5&is=693f0375&hm=2d3c0b2ee955a4f22f4ac1f5733e295cd1284f7fd0ab96a3458c1ed601f59e44&=&format=webp&width=918&height=1155"
}

### Expected: {"messageId": 1000005, "tracked": true}

### 3b. Post WebP 50% quality
POST {{host}}/test/image-message
Content-Type: application/json

{
  "imageUrl": "https://media.discordapp.net/attachments/1319991503891861534/1449832201385676992/frenchcat_50.webp?ex=694054f5&is=693f0375&hm=da1d9257e122b9b62b8990629a3ba1c5d02e8833443e090026365841f008021a&=&format=webp&width=900&height=1133"
}

### Expected: {"messageId": 1000006, "tracked": true}

### 3c. Query actions - expect 2 reactions (repost detected)
GET {{host}}/test/actions/1000006?expectedCount=2&timeout=10000

### Expected response:
# {
#   "messageId": 1000006,
#   "actions": [
#     {"type": "reaction", "data": "{\"emoji\":\":police_car:\"}", "timestamp": "..."},
#     {"type": "reaction", "data": "{\"emoji\":\":rotating_light:\"}", "timestamp": "..."}
#   ],
#   "waitedMs": 2500
# }
# PASS if: actions.length == 2 && both are type "reaction"

### ============================================
### NOTES
### ============================================
# - Each GET /test/actions waits for expectedCount or timeout
# - Timeout with partial results allows debugging (see what actions did occur)
# - Tests are machine-assertable: check actions.length and action types
# - Future: Can assert on message content for bot responses